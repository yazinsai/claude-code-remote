<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0d1117">
  <meta name="description" content="Remote access to Claude Code sessions from any device">

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230d1117' width='100' height='100' rx='20'/><text x='50' y='68' font-size='52' font-weight='600' text-anchor='middle' fill='%2358a6ff'>C</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230d1117' width='100' height='100'/><text x='50' y='68' font-size='52' font-weight='600' text-anchor='middle' fill='%2358a6ff'>C</text></svg>">

  <title>Claude Code Remote</title>
  <link rel="manifest" href="/manifest.json">

  <!-- xterm.js from CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.11.0/lib/addon-web-links.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-serialize@0.13.0/lib/addon-serialize.min.js"></script>

  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="app">
    <!-- Auth Screen -->
    <div id="auth-screen" class="screen active">
      <div class="auth-container">
        <!-- Logo -->
        <div class="auth-logo" aria-hidden="true">
          <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="64" height="64" rx="12" fill="rgba(88, 166, 255, 0.1)"/>
            <rect x="1" y="1" width="62" height="62" rx="11" stroke="rgba(88, 166, 255, 0.3)" stroke-width="1"/>
            <text x="32" y="44" font-size="32" font-weight="600" text-anchor="middle" fill="#58a6ff" font-family="system-ui, sans-serif">C</text>
          </svg>
        </div>

        <h1>Claude Code Remote</h1>
        <p class="subtitle">Connect to your local Claude Code session from anywhere</p>

        <form id="auth-form" onsubmit="return false;">
          <input
            type="text"
            id="token-input"
            placeholder="Enter auth token"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            aria-label="Authentication token"
          >
          <button id="connect-btn" class="btn-primary" type="submit">
            <span class="btn-text">Connect</span>
            <span class="btn-loading" aria-hidden="true">
              <svg class="spinner" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" stroke-opacity="0.3"/>
                <path d="M10 2a8 8 0 0 1 8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
          </button>
        </form>

        <p id="auth-error" class="error" role="alert" aria-live="polite"></p>
      </div>
    </div>

    <!-- Main Screen -->
    <div id="main-screen" class="screen">
      <!-- Collapsible Header -->
      <header id="header" role="toolbar" aria-label="Session controls">
        <div class="header-left">
          <!-- Mobile: Dropdown -->
          <select id="session-select" class="mobile-only" aria-label="Select session">
            <option value="">Select session...</option>
          </select>
          <!-- Desktop: Tabs -->
          <div id="session-tabs" class="session-tabs desktop-only" role="tablist" aria-label="Sessions"></div>
          <div class="header-left-actions">
            <button id="new-session-btn" class="btn-icon-minimal" title="Create new session" aria-label="Create new session">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
            </button>
            <button id="close-session-btn" class="btn-icon-minimal mobile-only" title="Close current session" aria-label="Close current session">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="header-right">
          <div id="reconnect-indicator" class="reconnect-indicator hidden" title="Reconnecting...">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12a9 9 0 1 1-9-9"/>
              <polyline points="21 3 21 9 15 9"/>
            </svg>
          </div>
          <button id="attach-btn" class="btn-icon" title="Attach image" aria-label="Attach image">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
            </svg>
          </button>
          <input type="file" id="image-input" accept="image/*" class="hidden" aria-hidden="true">
          <button id="preview-btn" class="btn-icon" title="Port preview" aria-label="Open port preview">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="3" width="20" height="14" rx="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
          </button>
          <button id="settings-btn" class="btn-icon" title="Settings" aria-label="Settings">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </button>
          <button id="toggle-header-btn-desktop" class="btn-icon desktop-only" title="Toggle header" aria-label="Toggle header visibility" aria-expanded="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon">
              <polyline points="18 15 12 9 6 15"/>
            </svg>
          </button>
          <button id="toggle-header-btn" class="btn-icon mobile-only" title="Toggle header" aria-label="Toggle header visibility" aria-expanded="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon">
              <polyline points="18 15 12 9 6 15"/>
            </svg>
          </button>
        </div>
      </header>

      <!-- Terminal Container -->
      <div id="terminal-container" role="application" aria-label="Terminal"></div>

      <!-- Scroll to bottom button (visible when terminal is scrolled up) -->
      <button id="scroll-bottom-btn" class="scroll-bottom-btn hidden" title="Scroll to bottom" aria-label="Scroll to bottom">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>

      <!-- Mobile Control Keys Toolbar (visible when keyboard is open on mobile) -->
      <div id="mobile-keys" class="mobile-keys hidden" role="toolbar" aria-label="Control keys">
        <button type="button" class="mobile-key" data-key="escape" aria-label="Escape">Esc</button>
        <button type="button" class="mobile-key mobile-key-modifier" data-key="ctrl" aria-label="Control modifier" aria-pressed="false">Ctrl</button>
        <button type="button" class="mobile-key mobile-key-modifier" data-key="shift" aria-label="Shift modifier" aria-pressed="false">Shift</button>
        <button type="button" class="mobile-key" data-key="tab" aria-label="Tab">Tab</button>
        <button type="button" class="mobile-key" data-key="slash" aria-label="Slash">/</button>
        <button type="button" class="mobile-key" data-key="up" aria-label="Arrow up">↑</button>
        <button type="button" class="mobile-key" data-key="down" aria-label="Arrow down">↓</button>
      </div>

      <!-- Floating expand button (visible when header collapsed) -->
      <button id="expand-header-btn" class="btn-icon floating-btn hidden" title="Show header" aria-label="Show header">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>

    </div>

    <!-- Preview Screen -->
    <div id="preview-screen" class="screen">
      <header role="toolbar" aria-label="Preview controls">
        <button id="back-btn" class="btn-icon" title="Back to terminal" aria-label="Back to terminal">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
        </button>
        <select id="port-select" aria-label="Select port to preview">
          <option value="">Select port...</option>
        </select>
        <input
          type="number"
          id="port-input"
          placeholder="Port"
          min="1"
          max="65535"
          aria-label="Enter port number"
        >
        <button id="go-port-btn" class="btn-icon" title="Go to port" aria-label="Go to port">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </button>
        <button id="refresh-preview-btn" class="btn-icon" title="Refresh preview" aria-label="Refresh preview">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"/>
            <polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
          </svg>
        </button>
      </header>
      <div id="preview-address-bar" class="preview-address-bar">
        <input
          type="text"
          id="address-input"
          placeholder="Enter path (e.g., /dashboard)"
          autocomplete="off"
          autocapitalize="off"
          autocorrect="off"
          spellcheck="false"
          aria-label="URL path"
        >
        <button id="address-go-btn" class="btn-icon" title="Navigate" aria-label="Navigate to path">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </button>
      </div>
      <iframe id="preview-frame" src="about:blank" title="Port preview"></iframe>
    </div>

    <!-- Schedules Screen -->
    <div id="schedules-screen" class="screen">
      <header class="schedules-header" role="toolbar" aria-label="Schedule controls">
        <button id="schedules-back-btn" class="btn-icon" title="Back to terminal" aria-label="Back to terminal">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
        </button>
        <h2 class="schedules-title">Scheduled Tasks</h2>
        <span id="schedules-header-badge" class="schedule-badge hidden">0</span>
        <div style="flex:1"></div>
        <button id="new-schedule-btn" class="btn-primary btn-small" aria-label="New schedule">+ New</button>
      </header>
      <div id="schedules-list" class="schedules-list">
        <div id="schedules-empty" class="empty-state">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <p>No scheduled tasks yet. Create one to run Claude on a recurring schedule.</p>
        </div>
      </div>
    </div>

    <!-- New Schedule Modal -->
    <div id="new-schedule-modal" class="modal hidden" role="dialog" aria-labelledby="new-schedule-title" aria-modal="true">
      <div class="modal-content">
        <h2 id="new-schedule-title">New Scheduled Task</h2>
        <p class="modal-description">Create a recurring task that runs Claude headlessly.</p>
        <div class="schedule-form">
          <input
            type="text"
            id="schedule-name-input"
            placeholder="Task name (e.g. Daily code review)"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
            aria-label="Schedule name"
          >
          <textarea
            id="schedule-prompt-input"
            placeholder="Prompt (e.g. Review open TODOs and summarize)"
            rows="3"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
            aria-label="Schedule prompt"
          ></textarea>
          <div class="autocomplete-wrapper">
            <input
              type="text"
              id="schedule-cwd-input"
              placeholder="Working directory (absolute path)"
              autocomplete="off"
              autocapitalize="off"
              autocorrect="off"
              spellcheck="false"
              aria-label="Working directory path"
              aria-autocomplete="list"
              aria-controls="schedule-cwd-suggestions"
            >
            <ul id="schedule-cwd-suggestions" class="suggestions hidden" role="listbox"></ul>
          </div>
          <input
            type="text"
            id="schedule-text-input"
            placeholder="e.g. every weekday at 9am, twice a week, daily at 3pm..."
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            aria-label="Schedule frequency"
          >
        </div>
        <div class="modal-actions">
          <button id="cancel-schedule-btn" class="btn-secondary">Cancel</button>
          <button id="create-schedule-btn" class="btn-primary">Create</button>
        </div>
      </div>
    </div>

    <!-- Run Log Modal -->
    <div id="run-log-modal" class="modal hidden" role="dialog" aria-labelledby="run-log-title" aria-modal="true">
      <div class="modal-content run-log-content">
        <div class="modal-header">
          <h2 id="run-log-title">Run Log</h2>
          <button id="close-run-log-btn" class="btn-icon" aria-label="Close">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <pre id="run-log-pre" class="run-log-pre"></pre>
      </div>
    </div>

    <!-- New Session Modal -->
    <div id="new-session-modal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true">
      <div class="modal-content">
        <h2 id="modal-title">New Session</h2>
        <p class="modal-description">Create a new terminal session with optional working directory.</p>
        <div class="autocomplete-wrapper">
          <input
            type="text"
            id="cwd-input"
            placeholder="Working directory (leave empty for current)"
            autocomplete="off"
            autocapitalize="off"
            autocorrect="off"
            spellcheck="false"
            aria-label="Working directory path"
            aria-autocomplete="list"
            aria-controls="cwd-suggestions"
          >
          <ul id="cwd-suggestions" class="suggestions hidden" role="listbox"></ul>
        </div>
        <div class="modal-actions">
          <button id="cancel-session-btn" class="btn-secondary">Cancel</button>
          <button id="create-session-btn" class="btn-primary">Create</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden" role="dialog" aria-labelledby="settings-title" aria-modal="true">
      <div class="modal-content settings-content">
        <div class="modal-header">
          <h2 id="settings-title">Settings</h2>
          <button id="close-settings-btn" class="btn-icon" aria-label="Close settings">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div class="setting-row">
          <div class="setting-info">
            <label for="notify-toggle">Input notifications</label>
            <p class="setting-description">Get notified when any session needs input</p>
          </div>
          <button id="notify-toggle" class="toggle" role="switch" aria-checked="false">
            <span class="toggle-track"></span>
            <span class="toggle-thumb"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
